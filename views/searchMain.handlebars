<form action = "/bids/search" method="POST" id="aboutForm" class="main-form">
    <label>
       <input id="search" name="searchInput" class="search-tf" type="text">
       <select name="category" >
            <option value ="electronics">electronics</option>
            <option value ="stationary">stationary</option>
            <option value ="tech">tech</option>
            <option value ="write">write</option>
        </select>
    </label> 
        <button class="search-btn" type="Submit">Search</button>
</form>
<link rel="stylesheet" href="/public/css/search.css">
 <script src = "/socket.io/socket.io.js"></script>
 <script>
        var socket = io();
        socket.on('broadcast',function(data){
        const st = "t_"+data.id;
        const tf = document.getElementById(st);
        if(tf)
            tf.value = data.price;
        console.log(bidCounters);
        console.log(data);
        if(bidCounters[data.id]){
            console.log(bidCounters[data.id]);
           var fu = bidCounters[data.id];
           fu(new Date(data.et));
        }
        });
</script>
<script>
    function onBid(id){
        var socket = io();
        var pricey = document.getElementById("t_"+id).value;
        price = parseFloat(pricey);
        const bid = {
            id : id,
            price : price + 0.10
        }
        socket.emit("bidEvent",bid);
    }
</script>

{{#if errors.length}}
    {{#each errors}}
    <p class="error">{{this}}</p>
    {{/each}}
{{/if}}

{{^errors}}
{{#if activeBidList.length}}
    <div class="searchResult">
    
<script> const bidCounters = {} ;</script>
    {{#each activeBidList}}
    <div class="bidItem">

        <div>
            <div>posted by: {{username}}</div>
            <img class="bid_img" src="{{show_img}}" 
            alt="../public/images/placeholder.png">
            <div class="text_center">{{item_title}}</div>
        </div>    
        
        <div class="counter-container">
            <div>Start bidding in last 30 Seconds</div>
            <div id="{{_id}}"></div>
            <div class="imp_fields">
            <input class="tf-num" value="{{current_price}}" id="t_{{_id}}" type="number" disabled>
            <button title="Adds 10 cents" class="bid_button" id="b_{{_id}}" onclick=onBid("{{_id}}")>Bid</button>
            </div>
            <script>
                var countDownDate_{{_id}} = new Date("{{ending_time}}").getTime();

                bidCounters["{{_id}}"] = function add10Mins_{{_id}}(et){  
                    countDownDate_{{_id}} = et;
                    document.getElementById("{{_id}}").style.backgroundColor = "yellow";
                    setInterval(function(){
                        document.getElementById("{{_id}}").style.backgroundColor = null;
                    },1000);
                };
                var x_{{_id}} = setInterval(function() {
                var now = new Date().getTime();
                var distance = countDownDate_{{_id}} - now;

                var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                if(hours < 10) hours = "0"+hours;
                var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                if(minutes < 10) minutes = "0"+minutes;
                var seconds = Math.floor((distance % (1000 * 60)) / 1000);
                if(seconds < 10) seconds = "0"+seconds;
    
                document.getElementById("{{_id}}").innerHTML = hours + " : "
                + minutes + " : " + seconds;
    
                if (distance < 0) {
                clearInterval(x_{{_id}});
                document.getElementById("{{_id}}").innerHTML = "EXPIRED";
                }
                }, 1000); 
             </script>
        </div>
    
    </div>
    {{/each}}
    </div>
{{/if}}
{{^activeBidList}}
    <main>
        <p class="not-found">We're sorry, but no results were found for .</p>
    </main>
{{/activeBidList}}
{{/errors}}
